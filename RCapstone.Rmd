---
title: "RCapstone"
author: "JoÃ«lle Koo"
date: "November 27, 2018"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

## Packages and Libraries
```{r}
#install.packages("lubridate")
library(lubridate)
#install.packages("dplyr")
library(dplyr)
#install.packages("geosphere")
library(geosphere)
#install.packages("ggplot2")
library(ggplot2)
#install.packages("magrittr")
library(magrittr)
#install.packages("corrplot")
library(corrplot)
#install.packages("Rmisc")
library(Rmisc)
#install.packages("GoodmanKruskal")
library(GoodmanKruskal)
#install.packages("igraph")
library(igraph)
#install.packages("TTR")
library(TTR)
#install.packages("randomForest")
library(randomForest)
#install.packages("glmnet")
library(glmnet)
#install.packages("standardize")
library(standardize)
#install.packages("caret")
library(caret)
#install.packages("rminer")
library(rminer)
#install.packages("car")
library(car)
```

## Load dataset
```{r}
set1 <- read.csv(file="/Users/Alex/Downloads/train.csv", stringsAsFactors = FALSE, header = TRUE)

```

```{r}
#Check for missing values
sapply(set1, function(x) sum(is.na(x)))
#No missing values identified
```

```{r}
#Check structure of dataset
str(set1)
```

##Feature Engineering
```{r}
#Extract month, day, weekday, hour and minute from pickup and dropoff date and time variables
set1$pickup_month <- month(set1$pickup_datetime)
set1$pickup_day <- day(set1$pickup_datetime)
set1$pickup_hour <- hour(set1$pickup_datetime)
set1$pickup_min <- minute(set1$pickup_datetime)
set1$pickup_wday <- wday(set1$pickup_datetime)

set1$dropoff_month <- month(set1$dropoff_datetime)
set1$dropoff_day <- day(set1$dropoff_datetime)
set1$dropoff_hour <- hour(set1$dropoff_datetime)
set1$dropoff_min <- minute(set1$dropoff_datetime)
set1$dropoff_wday <- wday(set1$dropoff_datetime)
```

```{r}
#Convert store_and_fwd_flag to numeric and assign 0 and 1 to the character variables N and Y

set1$store_and_fwd_flag[set1$store_and_fwd_flag == "N"] = "0"
set1$store_and_fwd_flag[set1$store_and_fwd_flag == "Y"] = "1"
set1$store_and_fwd_flag <- as.numeric(set1$store_and_fwd_flag)
```

```{r}
#Calculate distance (in meters) between pickup and dropoff locations
pickup_coord <- dplyr::select(set1, c(pickup_longitude, pickup_latitude))
dropoff_coord <- dplyr::select(set1, c(dropoff_longitude, dropoff_latitude))

set1$dist <- distCosine(pickup_coord, dropoff_coord)
```

```{r}
#Create pickup_class for analysis
set1$pickup_class <- cut(set1$pickup_wday, breaks=c(0,5,7), labels=c("w-day", "w-end"))
```

```{r}
#For the purpose of this project and due to memory limitations of R, I will only analyze data during spring season (March to May 2016) within morning and afternoon peak hours (between 7 and 10am and between 4 and 8pm)

#spring months
s1 <- set1[which(set1$pickup_month == '3'),]
s2 <- set1[which(set1$pickup_month == '4'),]
s3 <- set1[which(set1$pickup_month == '5'),]
spring <- rbind(s1,s2,s3)

#peak hours in the spring months
ph1 <- spring[which(spring$pickup_hour == '7'),]
ph2 <- spring[which(spring$pickup_hour == '8'),]
ph3 <- spring[which(spring$pickup_hour == '9'),]
ph4 <- spring[which(spring$pickup_hour == '16'),]
ph5 <- spring[which(spring$pickup_hour == '17'),]
ph6 <- spring[which(spring$pickup_hour == '18'),]
ph7 <- spring[which(spring$pickup_hour == '19'),]

spring_peakhours <- rbind(ph1,ph2,ph3,ph4,ph5,ph6,ph7)
```

```{r}
#Summary and structure of spring_peakhours dataset
summary(spring_peakhours)

str(spring_peakhours)
```

```{r}
#Outliers
nrow(spring_peakhours[spring_peakhours$trip_duration > 86300,])
nrow(spring_peakhours[spring_peakhours$trip_duration ==1,])

```

## Visualization of independent and response variables
```{r}
#vendor_id
p1 <- spring_peakhours %>%
  ggplot(aes(vendor_id, fill=vendor_id)) + geom_bar() + scale_x_discrete(limits=c("1", "2")) + theme(legend.position="none")

#passenger_count
p2 <- spring_peakhours %>%
  ggplot(aes(passenger_count, fill=passenger_count)) + geom_bar() + scale_y_sqrt() + theme(legend.position="none")

#store_and_fwd_flag
p3 <- spring_peakhours %>%
  ggplot(aes(store_and_fwd_flag)) + geom_bar()

p1_p3 <- matrix(c(1,2,3), byrow=TRUE)
source("http://peterhaschke.com/Code/multiplot.R")
multiplot(p1,p2,p3, rows=3)

spring_peakhours %>%
  ggplot(aes(pickup_class)) + geom_bar()
```

```{r}
#pickup_month by vendor_id
p4 <- spring_peakhours %>%
  group_by(pickup_month, vendor_id) %>%
  tally() %>%
  ggplot(aes(x=pickup_month, n, colour=vendor_id)) +
  geom_point(size=4) + 
  labs(x="spring months", y="total number of pickups") + scale_x_discrete(limits=c("0","0","March", "April", "May")) 

#pickup_day by vendor_id
p5 <- spring_peakhours %>%
  group_by(pickup_wday, vendor_id) %>%
  tally() %>%
  ggplot(aes(x=pickup_wday, n, colour=vendor_id)) +
  geom_point(size=4) + 
  labs(x="day of the week", y="total number of pickups") + scale_x_discrete(limits=c("Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"))

#pickup_hour by vendor_id
p6 <- spring_peakhours %>%
  group_by(pickup_hour, vendor_id) %>%
  tally() %>%
  ggplot(aes(x=pickup_hour, n, colour=vendor_id)) + geom_point(size=4) +
  labs(x = "hour of the day", y = "total number of pickups") +
  scale_x_discrete(limits=c("0","0","0","0","0","0","7","8","9","10","","","","","15","16","17","18","19"))

p4_p6 <- matrix(c(1,2,3), byrow=TRUE)
source("http://peterhaschke.com/Code/multiplot.R")
multiplot(p4,p5,p6, rows=3)
```

```{r}
#trip_duration - output variable
spring_peakhours %>%
  ggplot(aes(x=trip_duration)) +
  geom_histogram(bins=40000, fill="red") + ylab("Density") + coord_cartesian(x=c(0,6000))

#distribution is right-skewed - to treat this imbalance, log transformation is applied to normalize distribution in this visualization and in the prediction models. 

spring_peakhours %>%
  ggplot(aes(trip_duration)) + geom_histogram(bins=150, fill="red") + scale_x_log10() + scale_y_sqrt() + ylab("Density")
```

```{r}
#Transformation of trip_duration
transformed_tp <- log(spring_peakhours$trip_duration+1)
```

#Bivariate Analysis
```{r}
#Correlation Analysis
#numeric variables
sub_num <- subset(spring_peakhours, select=c(vendor_id, passenger_count, pickup_longitude, pickup_latitude, dropoff_longitude, dropoff_latitude,  store_and_fwd_flag ,trip_duration, pickup_month, pickup_day, pickup_hour, pickup_min, pickup_wday, dropoff_day, dropoff_hour, dropoff_min, dropoff_wday, dist))

cor_num <- cor(sub_num, method="pearson")
print(cor_num)
corrplot(cor_num, method="number")
```

```{r}
#Pairwise Relations
#trip_duration and (shortest) distance
set.seed(123)
spring_peakhours %>%
  sample_n(5e4) %>%
  ggplot(aes(x=dist, y=trip_duration)) + geom_point() +
  scale_x_log10() + scale_y_log10() +
  labs(x = "Direct distance in meters", y = "Trip duration in seconds")
```

```{r}
#pickup_day
aov_pickup_class <- aov(transformed_tp ~ pickup_class, data = spring_peakhours)
summary(aov_pickup_class)
#as the p-value is less than the significance level 0.05, there are significant differences between the two groups of pickup class

TukeyHSD(aov_pickup_class)

#1. Homogeneity of variances (aov assumption)
plot(aov_pickup_class, 1)
#No evident relationships between residuals and fitted values (mean of each groups) which is good and we can assume homogeneity of variances.

#Levene's test
leveneTest(transformed_tp ~ pickup_class, data = spring_peakhours)

#2. Normality
plot(aov_pickup_class, 2)
#The points fall aproximately along the reference line, we can assume normality.

#Run Shapiro-Wilk test to verify
aov_pickup_class_res <- residuals(object=aov_pickup_class)
shapiro.test(x = aov_pickup_class_res[0:5000])

#Kruskal Wallis
kruskal.test(transformed_tp ~ pickup_class, data = spring_peakhours)
```

```{r}
#Scatterplots to analyze relationships between independent and response variables
plot(transformed_tp ~ set1$vendor_id + set1$passenger_count + set1$pickup_longitude + set1$pickup_latitude + set1$dropoff_longitude + set1$dropoff_latitude + set1$store_and_fwd_flag + set1$pickup_month + set1$pickup_day + set1$pickup_hour + set1$pickup_min + set1$pickup_wday + set1$dropoff_month + set1$dropoff_day + set1$dropoff_hour + set1$dropoff_min + set1$dropoff_wday + set1$dist)
```

## Feature Selection
```{r}
#Remove strongly correlated variables, keeping variables with highest variance
var(spring_peakhours$pickup_month)
var(spring_peakhours$dropoff_month)
#keep dropoff_month

var(spring_peakhours$pickup_day)
var(spring_peakhours$dropoff_day)
#keep pickup_day

var(spring_peakhours$pickup_hour)
var(spring_peakhours$dropoff_hour)
#keep dropoff_hour

var(spring_peakhours$pickup_wday)
var(spring_peakhours$dropoff_wday)
#keep dropoff_wday
```

```{r}
#Create new.set based on feature selection
#Remove unique identifier id, pickup_datetime, dropoff_datetime and pickup_class

new.set <- subset(spring_peakhours, select=-c(id, pickup_datetime, dropoff_datetime, pickup_class, pickup_month, dropoff_day, pickup_hour, pickup_wday))
```

```{r}
#Standardize variables in new.set
s <- data.frame(vendor_id=scale(new.set$vendor_id),
                passenger_count=scale(new.set$passenger_count),
                pickup_longitude=scale(new.set$pickup_longitude),
                pickup_latitude=scale(new.set$pickup_latitude),
                dropoff_longitude=scale(new.set$dropoff_longitude),
                dropoff_latitude=scale(new.set$dropoff_latitude),
                store_and_fwd_flag=scale(new.set$store_and_fwd_flag),
                trip_duration=scale(new.set$trip_duration),
                pickup_day=scale(new.set$pickup_day),
                pickup_min=scale(new.set$pickup_min),
                dropoff_month=scale(new.set$dropoff_month),
                dropoff_hour=scale(new.set$dropoff_hour),
                dropoff_min=scale(new.set$dropoff_min),
                dist=scale(new.set$dist), dropoff_wday=scale(new.set$dropoff_wday))
```

## Prediction Models

```{r}
#Due to memory limitations in R, we will sample the dataset into 27 sets and average the performance measures for each model
set.seed(123)
sample_1 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(124)
sample_2 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(125)
sample_3 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(126)
sample_4 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(127)
sample_5 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(128)
sample_6 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(129)
sample_7 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(130)
sample_8 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(131)
sample_9 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(132)
sample_10 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(133)
sample_11 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(134)
sample_12 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(135)
sample_13 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(136)
sample_14 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(137)
sample_15 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(138)
sample_16 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(139)
sample_17 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(140)
sample_18 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(141)
sample_19 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(142)
sample_20 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(143)
sample_21 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(144)
sample_22 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(145)
sample_23 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(146)
sample_24 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(147)
sample_25 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(148)
sample_26 <- spring_peakhours[sample(1:nrow(spring_peakhours), 10000, replace=TRUE),]

set.seed(149)
sample_27 <- spring_peakhours[sample(1:nrow(spring_peakhours), 5193, replace=TRUE),]
```

```{r}
#To avoid an undefined log(0), we will add +1 in the formula of each prediction models.
```

```{r}
#Multiple Linear Regression with cross-validation

train.control_lm <- trainControl(method="cv", number=10)
s1_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_1, method="lm", trControl=train.control_lm)

lm1 <- print(s1_lm)
summary(s1_lm)
```

```{r}
s2_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_2, method="lm", trControl=train.control_lm)

lm2 <- print(s2_lm)
summary(s2_lm)
```

```{r}
s3_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_3, method="lm", trControl=train.control_lm)

lm3 <- print(s3_lm)
summary(s3_lm)
```

```{r}
s4_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_4, method="lm", trControl=train.control_lm)

lm4 <- print(s4_lm)
summary(s4_lm)
```

```{r}
s5_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_5, method="lm", trControl=train.control_lm)

lm5 <- print(s5_lm)
```

```{r}
s6_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_6, method="lm", trControl=train.control_lm)

lm6 <- print(s6_lm)
```

```{r}
s7_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_7, method="lm", trControl=train.control_lm)

lm7 <- print(s7_lm)
```

```{r}
s8_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_8, method="lm", trControl=train.control_lm)

lm8 <- print(s8_lm)
```

```{r}
s9_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_9, method="lm", trControl=train.control_lm)

lm9 <- print(s9_lm)
```

```{r}
s10_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_10, method="lm", trControl=train.control_lm)

lm10 <- print(s10_lm)
```

```{r}
s11_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_11, method="lm", trControl=train.control_lm)

lm11 <- print(s11_lm)
```

```{r}
s12_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_12, method="lm", trControl=train.control_lm)

lm12 <- print(s12_lm)
```

```{r}
s13_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_13, method="lm", trControl=train.control_lm)

lm13 <- print(s13_lm)
```

```{r}
s14_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_14, method="lm", trControl=train.control_lm)

lm14 <- print(s14_lm)
```

```{r}
s15_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_15, method="lm", trControl=train.control_lm)

lm15 <- print(s15_lm)
```

```{r}
s16_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_16, method="lm", trControl=train.control_lm)

lm16 <- print(s16_lm)
```

```{r}
s17_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_17, method="lm", trControl=train.control_lm)

lm17 <- print(s17_lm)
```

```{r}
s18_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_18, method="lm", trControl=train.control_lm)

lm18 <- print(s18_lm)
```

```{r}
s19_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_19, method="lm", trControl=train.control_lm)

lm19 <- print(s19_lm)
```

```{r}
s20_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_20, method="lm", trControl=train.control_lm)

lm20 <- print(s20_lm)
```

```{r}
s21_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_21, method="lm", trControl=train.control_lm)

lm21 <- print(s21_lm)
```

```{r}
s22_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_22, method="lm", trControl=train.control_lm)

lm22 <- print(s22_lm)
```

```{r}
s23_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_23, method="lm", trControl=train.control_lm)

lm23 <- print(s23_lm)
```

```{r}
s24_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_24, method="lm", trControl=train.control_lm)

lm24 <- print(s24_lm)
```

```{r}
s25_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_25, method="lm", trControl=train.control_lm)

lm25 <- print(s25_lm)
```

```{r}
s26_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_26, method="lm", trControl=train.control_lm)

lm26 <- print(s26_lm)
```

```{r}
s27_lm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_27, method="lm", trControl=train.control_lm)

lm27 <- print(s27_lm)
```

```{r}
#Calculate average of RMSE, Rsquared and MSE of all 27 lm models

lm_df <- rbind(lm1,lm2,lm3,lm4,lm5,lm6,lm7,lm8,lm9,lm10,lm11,lm12,lm13,lm14,lm15,lm16,lm17,lm18,lm19,lm20,lm21,lm22,lm23,lm24,lm25,lm26,lm27)
```

```{r}
#Random Forest with cross-validation

train_control_rf <- trainControl(method="cv", number=10)
s1_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_1, method="rf", trControl=train_control_rf)

rf1 <- print(s1_rf)
```

```{r}
s2_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_2, method="rf", trControl=train_control_rf)

rf2 <- print(s2_rf)

s3_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_3, method="rf", trControl=train_control_rf)

rf3 <- print(s3_rf)

s4_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_4, method="rf", trControl=train_control_rf)

rf4 <- print(s4_rf)

s5_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_5, method="rf", trControl=train_control_rf)

rf5 <- print(s5_rf)

s6_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_6, method="rf", trControl=train_control_rf)

rf6 <- print(s6_rf)

s7_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_7, method="rf", trControl=train_control_rf)

rf7 <- print(s7_rf)

s8_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_8, method="rf", trControl=train_control_rf)

rf8 <- print(s8_rf)

s9_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_9, method="rf", trControl=train_control_rf)

rf9 <- print(s9_rf)

s10_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_10, method="rf", trControl=train_control_rf)

rf10 <- print(s10_rf)

s11_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_11, method="rf", trControl=train_control_rf)

rf11 <- print(s11_rf)

s12_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_12, method="rf", trControl=train_control_rf)

rf12 <- print(s12_rf)

s13_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_13, method="rf", trControl=train_control_rf)

rf13 <- print(s13_rf)

s14_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_14, method="rf", trControl=train_control_rf)

rf14 <- print(s14_rf)

s15_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_15, method="rf", trControl=train_control_rf)

rf15 <- print(s15_rf)

s16_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_16, method="rf", trControl=train_control_rf)

rf16 <- print(s16_rf)

s17_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_17, method="rf", trControl=train_control_rf)

rf17 <- print(s17_rf)
```

```{r}
s18_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_18, method="rf", trControl=train_control_rf)

rf18 <- print(s18_rf)

s19_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_19, method="rf", trControl=train_control_rf)

rf19 <- print(s19_rf)

s20_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_20, method="rf", trControl=train_control_rf)

rf20 <- print(s20_rf)

s22_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_22, method="rf", trControl=train_control_rf)

rf22 <- print(s22_rf)

s21_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_21, method="rf", trControl=train_control_rf)

rf21 <- print(s21_rf)

s23_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_23, method="rf", trControl=train_control_rf)

rf23 <- print(s23_rf)

s24_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_24, method="rf", trControl=train_control_rf)

rf24 <- print(s24_rf)

s25_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_25, method="rf", trControl=train_control_rf)

rf25 <- print(s25_rf)

s26_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_26, method="rf", trControl=train_control_rf)

rf26 <- print(s26_rf)
```

```{r}
s27_rf <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_27, method="rf", trControl=train_control_rf, importance=TRUE)

rf27 <- print(s27_rf)
```

```{r}
#Calculate average of RMSE, Rsquared and MSE of all 27 rf models

rf_df <- rbind(rf1,rf2,rf3,rf4,rf5,rf6,rf7,rf8,rf9,rf10,rf11,rf12,rf13,rf14,rf15,rf16,rf17,rf18,rf19,rf20,rf21,rf22,rf23,rf24,rf25,rf26,rf27)

```

```{r}
#Support Vector Regression with cross-validation

train.control_svm <- trainControl(method="cv", number=10, savePred = T )
s1_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_1, method="svmLinear", trControl=train.control_svm)

svm1 <- print(s1_svm)
```

```{r}
s2_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_2, method="svmLinear", trControl=train.control_svm)

svm2 <- print(s2_svm)

s3_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_3, method="svmLinear", trControl=train.control_svm)

svm3 <- print(s3_svm)

s4_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_4, method="svmLinear", trControl=train.control_svm)

svm4 <- print(s4_svm)

s5_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_5, method="svmLinear", trControl=train.control_svm)

svm5 <- print(s5_svm)

s6_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_6, method="svmLinear", trControl=train.control_svm)

svm6 <- print(s6_svm)

s7_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_7, method="svmLinear", trControl=train.control_svm)

svm7 <- print(s7_svm)

s8_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_8, method="svmLinear", trControl=train.control_svm)

svm8 <- print(s8_svm)

s9_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_9, method="svmLinear", trControl=train.control_svm)

svm9 <- print(s9_svm)

s10_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_10, method="svmLinear", trControl=train.control_svm)

svm10 <- print(s10_svm)

s11_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_11, method="svmLinear", trControl=train.control_svm)

svm11 <- print(s11_svm)

s12_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_12, method="svmLinear", trControl=train.control_svm)

svm12 <- print(s12_svm)

s13_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_13, method="svmLinear", trControl=train.control_svm)

svm13 <- print(s13_svm)

s14_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_14, method="svmLinear", trControl=train.control_svm)

svm14 <- print(s14_svm)

s15_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_15, method="svmLinear", trControl=train.control_svm)

svm15 <- print(s15_svm)

s16_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_16, method="svmLinear", trControl=train.control_svm)

svm16 <- print(s16_svm)

s17_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_17, method="svmLinear", trControl=train.control_svm)

svm17 <- print(s17_svm)

s18_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_18, method="svmLinear", trControl=train.control_svm)

svm18 <- print(s18_svm)

s19_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_19, method="svmLinear", trControl=train.control_svm)

svm19 <- print(s19_svm)

s20_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_20, method="svmLinear", trControl=train.control_svm)

svm20 <- print(s20_svm)

s21_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_21, method="svmLinear", trControl=train.control_svm)

svm21 <- print(s21_svm)

s22_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_22, method="svmLinear", trControl=train.control_svm)

svm22 <- print(s22_svm)

s23_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_23, method="svmLinear", trControl=train.control_svm)

svm23 <- print(s23_svm)

s24_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_24, method="svmLinear", trControl=train.control_svm)

svm24 <- print(s24_svm)

s25_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_25, method="svmLinear", trControl=train.control_svm)

svm25 <- print(s25_svm)

s26_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_26, method="svmLinear", trControl=train.control_svm)

svm26 <- print(s26_svm)

s27_svm <- train(log(trip_duration+1) ~ vendor_id + passenger_count + pickup_day + pickup_min + pickup_longitude + pickup_latitude + dropoff_longitude + dropoff_month + dropoff_hour + dist, data=sample_27, method="svmLinear", trControl=train.control_svm)

svm27 <- print(s27_svm)
```

```{r}
#Calculate average of RMSE, Rsquared and MSE of all 27 svm models

svm_df <- rbind(svm1,svm2,svm3,svm4,svm5,svm6,svm7,svm8,svm9,svm10,svm11,svm12,svm13,svm14,svm15,svm16,svm17,svm18,svm19,svm20,svm21,svm22,svm23,svm24,svm25,svm26,svm27)
```